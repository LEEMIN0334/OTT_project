<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.memberInfoMapper">

    <resultMap id="UsersDTO" type="dto.UsersDTO">
        <id property="memberNum" column="memberNum"/>
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="email" column="email"/>
        <result property="birth" column="birth"/>
        <result property="password" column="password"/>
    </resultMap>

    <!-- 사용자 정보 삽입 쿼리 -->
    <insert id="insertMember" parameterType="dto.UsersDTO">
        INSERT INTO Users (memberNum, id, name, email, birth, password)
        VALUES (
            'A' || LPAD((SELECT NVL(MAX(TO_NUMBER(SUBSTR(memberNum, 2))), 0) + 1 FROM Users), 3, '0'),
            #{id},
            #{name},
            #{email},
            #{birth},
            standard_hash(#{password}, 'SHA512')
        )
    </insert>
    <!-- 사용자 정보 조회 -->
    
    <select id="selectUserById" parameterType="String" resultType="dto.UsersDTO">
        SELECT memberNum, id, name, email, birth, password
        FROM Users
        WHERE id = #{id}
    </select>
	</mapper>